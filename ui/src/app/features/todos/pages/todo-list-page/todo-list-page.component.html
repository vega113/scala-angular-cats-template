<section class="todos-page">
  <header class="todos-page__header">
    <div>
      <h1>My Todos</h1>
      <p class="todos-page__subtitle">
        Manage your tasks and keep track of progress. Data is loaded from the backend API.
      </p>
    </div>
    <button type="button" class="todos-page__create" (click)="createTodo()">
      Create Todo
    </button>
  </header>

  <section class="todos-page__toolbar" aria-label="Todo filters">
    <div class="todos-page__filters">
      <span>Filter:</span>
      <button
        type="button"
        class="todos-page__filter"
        [class.todos-page__filter--active]="currentFilter() === 'all'"
        (click)="setFilter('all')"
      >
        All
      </button>
      <button
        type="button"
        class="todos-page__filter"
        [class.todos-page__filter--active]="currentFilter() === 'open'"
        (click)="setFilter('open')"
      >
        Open
      </button>
      <button
        type="button"
        class="todos-page__filter"
        [class.todos-page__filter--active]="currentFilter() === 'done'"
        (click)="setFilter('done')"
      >
        Completed
      </button>
    </div>

    <div class="todos-page__pagination">
      <button type="button" (click)="previousPage()" [disabled]="!hasPreviousPage() || loading()">
        ‹ Previous
      </button>
      <button type="button" (click)="nextPage()" [disabled]="!hasNextPage() || loading()">
        Next ›
      </button>
    </div>
  </section>

  @if (flashMessage()) {
    <div class="todos-page__alert todos-page__alert--success">
      {{ flashMessage() }}
    </div>
  }

  @if (hasError()) {
    <div class="todos-page__alert todos-page__alert--error">
      {{ errorMessage() }}
      <button type="button" (click)="refresh()">Retry</button>
    </div>
  }

  @if (loading() && refreshing()) {
    <div class="todos-page__loading">Loading todos …</div>
  } @else {
    @if (!hasTodos()) {
      <div class="todos-page__empty">
        <p>
          @if (currentFilter() === 'all') {
            No todos yet. Create your first task to get started.
          } @else if (currentFilter() === 'open') {
            No open todos right now.
          } @else {
            No completed todos yet.
          }
        </p>
        <button type="button" (click)="createTodo()">Create Todo</button>
      </div>
    } @else {
      <ul class="todos-page__list">
        @for (item of todos(); track item.id) {
          <li class="todos-page__item">
            <div class="todos-page__itemContent">
              <h2 [class.todos-page__itemTitle--done]="item.completed">
                {{ item.title }}
              </h2>
              @if (item.description) {
                <p class="todos-page__description">{{ item.description }}</p>
              }
              <p class="todos-page__meta">
                Status:
                <strong>{{ item.completed ? 'Done' : 'Open' }}</strong>
                @if (item.dueDate) {
                  <span> · Due {{ item.dueDate | date: 'mediumDate' }}</span>
                }
              </p>
            </div>
            <div class="todos-page__actions">
              <button type="button" (click)="toggleCompletion(item)">
                Mark {{ item.completed ? 'Open' : 'Done' }}
              </button>
              <button type="button" (click)="editTodo(item)">Edit</button>
              <button type="button" class="danger" (click)="deleteTodo(item)">Delete</button>
            </div>
          </li>
        }
      </ul>
    }
  }
</section>
